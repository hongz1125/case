<section id="app">
    {{> head}}
    {{> left}}
    <section class="ux_body">
        <section>
            <el-form :inline="true" class="demo-form-inline">
                <el-form-item>
                    <el-input v-model="tag" placeholder="添加标签"></el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="on_add">添加</el-button>
                </el-form-item>
            </el-form>
        </section>
        <br />
        <section v-loading.fullscreen.lock="loading">
            <el-table :data="list" style="width: 100%">
                <el-table-column prop="id" label="#" width="80">
                </el-table-column>
                <el-table-column prop="value" label="标签"></el-table-column>
                <el-table-column label="操作" inline-template>
                    <section>
                        <el-button type='primary' size="small" @click="on_del(row.id)">删除</el-button>
                    </section>
                </el-table-column>
            </el-table>
            <div class="ux_page">
                <el-pagination @current-change="handleCurrentChange" :current-page.sync="page" :page-size="page_size" layout="total, prev, pager, next" :total="page_total">
                </el-pagination>
            </div>
        </section>
    </section>
</section>
<script>
new Vue({
    el: '#app',
    data: {
        list: [],
        page_total: 0,
        page_size: 10,
        page: 1,
        tag: '',
        loading: true,
        dialog_edit: false,
    },
    methods: {
        handleCurrentChange: function(val) {
            this.page = val;
            this.get_list();
        },
        on_add: function() {
            if (!this.tag) return;
            this.loading = true;
            do_ajax({
                url: '/api/tag/add',
                data: {
                    value: this.tag
                }
            }).then(res => {
                this.get_list();
                this.loading = false;
            }).catch(msg => {
                this.$message.error(msg);
                this.loading = false;
            })
        },
        on_del: function(id) {
            this.loading = true;
            do_ajax({
                url: '/api/tag/del',
                data: {
                    id: id
                }
            }).then(res => {
                this.get_list();
                this.loading = false;
            }).catch(msg => {
                this.$message.error(msg);
                this.loading = false;
            })
        },
        get_list: function() {
            this.loading = true;
            do_ajax({
                url: '/api/tag/list',
                data: {
                    page: this.page,
                    page_size: this.page_size
                }
            }).then(res => {
                this.list = res.data.list;
                this.page_total = res.data.page_total;
                this.loading = false;
            }).catch(msg => {
                this.$message.error(msg);
            })
        }
    },
    mounted: function() {
        this.get_list({
            page_size: this.page_size,
            page: this.page
        });
    }
})
</script>
